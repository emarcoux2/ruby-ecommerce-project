<h1 class="title">Your Cart</h1>

<% if @cart_products.empty? %>
  <p>Your cart is empty! Go shopping!</p>
<% else %>
  <table class="table is-striped is-fullwidth">
    <thead>
      <tr>
        <th>Product</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @cart_products.each do |product| %>
        <% qty = @cart[product.id.to_s] %>
        <tr>
          <td><%= link_to product.name, product %></td>
          <td><%= qty %></td>
          <td><%= number_to_currency(product.price) %></td>
          <td><%= number_to_currency(product.price * qty) %></td>
          <td>
            <%= button_to "Remove", cart_path(product_id: product.id), method: :delete %>
          </td>
        </tr>
      <% end %>
    </tbody>
    </tbody>
  </table>
  
  <p><strong>Subtotal:</strong> <%= number_to_currency(@subtotal_cents / 100.0) %></p>
  <p><strong>Taxes:</strong> <%= number_to_currency(@tax_cents / 100.0) %></p>
  <p><strong>Total:</strong> <%= number_to_currency(@total_cents / 100.0) %></p>

  <p><%= button_to "Remove All Items", cart_path, method: :delete %></p>
  <p><%= button_to "Checkout", checkout_create_session_path, method: :post, data: { turbo: false } %></p>
<% end %>